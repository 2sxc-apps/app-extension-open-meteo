@inherits Custom.Hybrid.RazorTyped
@using System.Linq
@using AppCode.Extensions.OpenMeteo

@*
  Note:
  These are demo/test Razor files. brav
*@

@{
  // Test 1: Explicit parameters (typical usage)
  var forecastWithParams = Kit.Data.GetSource<OpenMeteoForecast>(
    parameters: new
    {
      Latitude = 47.3769,
      Longitude = 8.5417,
      Timezone = "auto",
      ForecastDays = 2
    }
  );

  // Do not assume properties must exist; allow missing props without throwing.
  var itemsWithParams = AsItems(forecastWithParams, propsRequired: false).Take(24).ToList();

  // Test 2: No parameters (should "just work" if the DataSource has sensible defaults)
  var forecastNoParams = Kit.Data.GetSource<OpenMeteoForecast>();
  var itemsNoParams = AsItems(forecastNoParams, propsRequired: false).Take(6).ToList();
}

<h3>Open-Meteo Forecast (with parameters, next @itemsWithParams.Count hours)</h3>

<table class="table">
  <thead>
    <tr>
      <th>Time</th>
      <th>Temp (°C)</th>
      <th>Wind</th>
      <th>Code</th>
    </tr>
  </thead>
  <tbody>
  @foreach (var item in itemsWithParams)
  {
    <tr>
      <td>@item.String("When", fallback: "-")</td>
      <td>@item.Double("Temperature", required: false)</td>
      <td>@item.Double("WindSpeed", required: false)</td>
      <td>@item.Double("WeatherCode", required: false)</td>
    </tr>
  }
  </tbody>
</table>

<hr />

<h3>Open-Meteo Forecast (no parameters, sample @itemsNoParams.Count rows)</h3>

<p>
  This verifies the DataSource can run without parameters (it must provide defaults internally).
</p>

<table class="table">
  <thead>
    <tr>
      <th>Time</th>
      <th>Temp (°C)</th>
      <th>Wind</th>
      <th>Code</th>
    </tr>
  </thead>
  <tbody>
  @foreach (var item in itemsNoParams)
  {
    <tr>
      <td>@item.String("When", fallback: "-")</td>
      <td>@item.Double("Temperature", required: false)</td>
      <td>@item.Double("WindSpeed", required: false)</td>
      <td>@item.Double("WeatherCode", required: false)</td>
    </tr>
  }
  </tbody>
</table>
